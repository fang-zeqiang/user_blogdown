<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

        <title>åˆ©ç”¨ Flask å’Œ Google App Engine éƒ¨ç½²æ¨¡å‹æœåŠ¡ - Zeqiang Fang | æ–¹æ³½å¼º</title>

    <meta name="referrer" content="no-referrer">
    
    <meta property="og:title" content="åˆ©ç”¨ Flask å’Œ Google App Engine éƒ¨ç½²æ¨¡å‹æœåŠ¡ - Zeqiang Fang | æ–¹æ³½å¼º">
    <meta name="description" property="og:description" content="æœ¬æ–‡çš„é…å¥—ä»£ç è¯·å‚è§ è¿™é‡Œï¼Œå»ºè®®é…åˆä»£ç é˜…è¯»æœ¬æ–‡ã€‚ æ¨¡å‹éƒ¨ç½²å’ŒæœåŠ¡è°ƒç”¨ å¯¹äºåšç®—æ³•çš„åŒå­¦ï¼Œå¤§å®¶æˆ–å¤šæˆ–å°‘çš„æ›´å…³å¿ƒæ¨¡å‹çš„æ€§èƒ½æŒ‡æ ‡å¤šäº›ï¼Œå¯¹äºä¸€äº›å·¥ç¨‹æ€§é—®">
    <meta property="og:type" content="article">
    <meta property="og:site_name" content="Zeqiang Fang | æ–¹æ³½å¼º">
    <meta property="og:url" content="http://zeqiang.fun/user_blogdown/cn/2018/10/serving-models-with-flask-and-gae/">

    
    
    
    
    <meta name="author" property="article:author" content="èŒƒå¶äº®">
    
    
    
    <meta name="date" property="article:published_time" content="2018-10-19" scheme="YYYY-MM-DD">
    
    
    <meta name="date" property="article:modified_time" content="2018-10-19" scheme="YYYY-MM-DD">
    

    
    <meta name="keywords" property="article:tag" content ="Flask,Google App Engine,GAE,RESTful,æ¨¡å‹éƒ¨ç½²,æ¨¡å‹æœåŠ¡">
    
    
    <meta name="theme-color" content="#0d0d0d">
    
    <link rel="icon" type="image/png" sizes="16x16" href="/images/web/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/web/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="48x48" href="/images/web/favicon-48x48.png">
    <link rel="icon" type="image/png" sizes="62x62" href="/images/web/favicon-62x62.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/images/web/favicon-192x192.png">
    <link rel="apple-touch-icon" size="192x192" href="/images/web/icon-192x192.png">
    <link rel="manifest" href="/manifest.json">
        
    

    

    <script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http://zeqiang.fun/user_blogdown/cn"
        },
        "name": "åˆ©ç”¨ Flask å’Œ Google App Engine éƒ¨ç½²æ¨¡å‹æœåŠ¡",
        "headline": "åˆ©ç”¨ Flask å’Œ Google App Engine éƒ¨ç½²æ¨¡å‹æœåŠ¡",
        "description" : "æœ¬æ–‡çš„é…å¥—ä»£ç è¯·å‚è§ è¿™é‡Œï¼Œå»ºè®®é…åˆä»£ç é˜…è¯»æœ¬æ–‡ã€‚ æ¨¡å‹éƒ¨ç½²å’ŒæœåŠ¡è°ƒç”¨ å¯¹äºåšç®—æ³•çš„åŒå­¦ï¼Œå¤§å®¶æˆ–å¤šæˆ–å°‘çš„æ›´å…³å¿ƒæ¨¡å‹çš„æ€§èƒ½æŒ‡æ ‡å¤šäº›ï¼Œå¯¹äºä¸€äº›å·¥ç¨‹æ€§é—®",
        "genre": [
            "ç¼–ç¨‹", "æœºå™¨å­¦ä¹ ", "æ·±åº¦å­¦ä¹ "
        ],
        "datePublished": "2018-10-19",
        "dateModified": "2018-10-19",
        "wordCount": "4543",
        "keywords": [
            "Flask", "Google App Engine", "GAE", "RESTful", "æ¨¡å‹éƒ¨ç½²", "æ¨¡å‹æœåŠ¡"
        ],
        "image": [
            "http://zeqiang.fun/images/cn/2018-10-19-serving-models-with-flask-and-gae/model-serving.png"
        ],
        "author": {
            "@type": "Person",
            "name": "èŒƒå¶äº®"
        },
        "publisher": {
            "@type": "Organization",
            "name": "èŒƒå¶äº®",
            "logo": {
                "@type": "ImageObject",
                "url": "http://zeqiang.fun/images/web/publisher-logo.png"
            }
        },
        "url": "http://zeqiang.fun/user_blogdown/cn/2018/10/serving-models-with-flask-and-gae/"
    }
    </script>
    

    <script src='//cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js'></script>
<script src='//cdnjs.cloudflare.com/ajax/libs/js-cookie/2.2.1/js.cookie.min.js'></script>

<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/MaterialDesign-Webfont/6.5.95/css/materialdesignicons.min.css">





<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/themes/prism.min.css">

<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/themes/prism-.min.css">





<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<link rel="stylesheet" type="text/css" href="/user_blogdown/css/fonts.css" />
<link rel="stylesheet" type="text/css" href="/user_blogdown/css/style.css">
<link rel="stylesheet" type="text/css" href="/user_blogdown/css/light.css">
<link rel="stylesheet" type="text/css" href="/user_blogdown/css/dark.css" id="dark-mode-style" disabled="disabled">
<link rel="stylesheet" type="text/css" href="/user_blogdown/css/icons.css">
<link rel="stylesheet" type="text/css" href="/user_blogdown/css/print.css">

  </head>

  
  <body class="user_blogdown">
    <header class="masthead">
      

<div class="logo"></div>
<p class="slogan">ä¼˜é›…æ°¸ä¸è¿‡æ—¶</p>
      <nav class="menu">
  <ul>
  
  
  
    
  
  
    <li><a href="/user_blogdown/">é¦–é¡µ</a></li>
  
    <li><a href="/user_blogdown/cn/">åšå®¢</a></li>
  
    <li><a href="/user_blogdown/cn/about/">å…³äº</a></li>
  
    <li class="menu-separator"><span>&nbsp;</span></li>
  
    <li><a href="/user_blogdown/">Home</a></li>
  
    <li><a href="/user_blogdown/en/">Blog</a></li>
  
    <li><a href="/user_blogdown/en/about/">About</a></li>
  
  


<li class="menu-separator"><span>&nbsp;</span></li>

<li><a href="/cn/index.xml" target="_blank" type="application/rss+xml" title="RSS feed">è®¢é˜…</a></li>

<li><a href="https://github.com/fang-zeqiang/fang-zeqiang.github.io/blob/master/LICENSE" target="_blank" title="Attribution-NonCommercial-ShareAlike 4.0 International">ç‰ˆæƒ</a></li>


  <li class="light-dark-mode no-border-bottom"><a id="light-dark-mode-action"><span id="light-dark-mode-icon" class="mdi mdi-weather-night"></span></a></li>
  </ul>
</nav>

      <script src="/js/toggle-theme.js"></script>
    </header>

    <article class="main">
      <header class="title">
      
<h1>åˆ©ç”¨ Flask å’Œ Google App Engine éƒ¨ç½²æ¨¡å‹æœåŠ¡</h1>







<h3>èŒƒå¶äº® / 
2018-10-19</h3>



<h3 class="post-meta">


<strong>åˆ†ç±»: </strong>
<a href="/user_blogdown/categories/%E7%BC%96%E7%A8%8B">ç¼–ç¨‹</a>, <a href="/user_blogdown/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0">æœºå™¨å­¦ä¹ </a>, <a href="/user_blogdown/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0">æ·±åº¦å­¦ä¹ </a>




/




<strong>æ ‡ç­¾: </strong>
<span>Flask</span>, <span>Google App Engine</span>, <span>GAE</span>, <span>RESTful</span>, <span>æ¨¡å‹éƒ¨ç½²</span>, <span>æ¨¡å‹æœåŠ¡</span>




/


<strong>å­—æ•°: </strong>
4543
</h3>



<hr>


      </header>






<div class="blockquote" style='border-left: 4px solid #369BE5;'>æœ¬æ–‡çš„é…å¥—ä»£ç è¯·å‚è§ <a href="https://github.com/leovan/model-serving-demo" rel="noreferrer" target="_blank">è¿™é‡Œ</a>ï¼Œå»ºè®®é…åˆä»£ç é˜…è¯»æœ¬æ–‡ã€‚</div>

<h2 id="æ¨¡å‹éƒ¨ç½²å’ŒæœåŠ¡è°ƒç”¨">æ¨¡å‹éƒ¨ç½²å’ŒæœåŠ¡è°ƒç”¨</h2>

<p>å¯¹äºåšç®—æ³•çš„åŒå­¦ï¼Œå¤§å®¶æˆ–å¤šæˆ–å°‘çš„æ›´å…³å¿ƒæ¨¡å‹çš„æ€§èƒ½æŒ‡æ ‡å¤šäº›ï¼Œå¯¹äºä¸€äº›å·¥ç¨‹æ€§é—®é¢˜è€ƒè™‘çš„è¾ƒå°‘ã€‚æ¨¡å‹çš„éƒ¨ç½²æ˜¯è¿™äº›å·¥ç¨‹æ€§é—®é¢˜ä¸­é‡è¦çš„ä¸€ä¸ªï¼Œå®ƒç›´æ¥å…³ç³»åˆ°æ¨¡å‹åœ¨ç”Ÿäº§ç³»ç»Ÿçš„ä½¿ç”¨ã€‚ä¸€äº›æˆç†Ÿçš„æœºå™¨å­¦ä¹ æ¡†æ¶ä¼šæä¾›è‡ªå·±çš„è§£å†³æ–¹æ¡ˆï¼Œä¾‹å¦‚ <a href="https://www.tensorflow.org" rel="noreferrer" target="_blank">Tensorflow</a> æä¾›çš„ <a href="https://www.tensorflow.org/serving/" rel="noreferrer" target="_blank">Serving</a> æœåŠ¡ç­‰ã€‚ä½†å¾ˆå¤šæƒ…å†µä¸‹æˆ‘ä»¬æ„å»ºçš„å·¥ç¨‹å¯èƒ½ä¸åªä½¿ç”¨äº†ä¸€ç§æ¡†æ¶ï¼Œå› æ­¤ä¸€ä¸ªæ¡†æ¶è‡ªèº«çš„éƒ¨ç½²å·¥å…·å¯èƒ½å°±å¾ˆéš¾æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚äº†ã€‚</p>

<p>é’ˆå¯¹æ­¤ç±»æƒ…å†µï¼Œæœ¬æ–‡ä»‹ç»ä¸€ä¸ª <strong>ç®€å•</strong> çš„ <strong>å‡†ç”Ÿäº§</strong> æ¨¡å‹éƒ¨ç½²æ–¹æ¡ˆã€‚ç®€å•æ˜¯æŒ‡é™¤äº†æ¨¡å‹ç›¸å…³ä»£ç ä¹‹å¤–çš„å·¥ç¨‹æ€§ä»£ç é‡ä¸å¤§ï¼Œè¿™å¾—ç›Šäºå°†è¦ä½¿ç”¨çš„ <a href="http://flask.pocoo.org/" rel="noreferrer" target="_blank">Flask</a> æ¡†æ¶ã€‚å‡†ç”Ÿäº§æ˜¯æŒ‡è¿™ç§éƒ¨ç½²æ–¹æ¡ˆåº”å¯¹ä¸€èˆ¬çš„ç”Ÿäº§ç¯å¢ƒé—®é¢˜ä¸å¤§ï¼Œå¯¹äºé«˜å¹¶å‘çš„åœºæ™¯å¯ä»¥é€šè¿‡æ¨ªå‘æ‰©å®¹å¹¶è¿›è¡Œè´Ÿè½½å‡è¡¡è§£å†³ï¼Œä½†å¯¹äºå•æ¬¡è°ƒç”¨æ—¶æ•ˆæ€§è¦æ±‚è¾ƒé«˜çš„åœºæ™¯åˆ™éœ€è¦å¦å¯»å…¶ä»–è§£å†³æ–¹æ¡ˆã€‚</p>

<p>æœ¬æ–‡æ–¹æ¡ˆçš„æ¨¡å‹éƒ¨ç½²å’ŒæœåŠ¡è°ƒç”¨æ¡†æ¶å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>

<p><img src="/images/cn/2018-10-19-serving-models-with-flask-and-gae/model-serving.png" alt="Model-Serving" /></p>

<p>å…¶ä¸»è¦ç‰¹æ€§å¦‚ä¸‹ï¼š</p>

<ol>
<li>æœåŠ¡ç«¯é‡‡ç”¨ Python çš„ Flask æ¡†æ¶æ„å»ºï¼Œæ— éœ€ä½¿ç”¨å…¶ä»–å¤–éƒ¨æœåŠ¡ã€‚Flask æ¡†æ¶çš„ <a href="https://zh.wikipedia.org/zh/å¾®æœåŠ¡" rel="noreferrer" target="_blank">å¾®æœåŠ¡</a> (Microframework) ç‰¹æ€§ä½¿å¾—æœåŠ¡ç«¯ä»£ç ç®€æ´é«˜æ•ˆã€‚</li>
<li>åˆ©ç”¨ <a href="https://gunicorn.org/" rel="noreferrer" target="_blank">Gunicorn</a> æä¾›çš„é«˜æ€§èƒ½ Python WSGI HTTP UNIX Serverï¼Œæ–¹ä¾¿åœ¨æœåŠ¡ç«¯è¿è¡Œ Flask åº”ç”¨ã€‚</li>
<li>å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´é‡‡ç”¨ <a href="https://zh.wikipedia.org/zh/è¡¨ç°å±‚çŠ¶æ€è½¬æ¢" rel="noreferrer" target="_blank">RESTful API</a> è°ƒç”¨æ–¹å¼ï¼Œå°½ç®¡åœ¨æ€§èƒ½ä¸Šå¯èƒ½ä¸åŠå…¶ä»–ä¸€äº›æ–¹æ¡ˆ (ä¾‹å¦‚ï¼šåŸºäº RPC çš„è§£å†³æ–¹æ¡ˆç­‰)ï¼Œä½†å…¶è¾ƒå¥½åœ°è§£å†³äº†è·¨è¯­è¨€äº¤äº’çš„é—®é¢˜ï¼Œä¸åŒè¯­è¨€ä¹‹é—´äº¤äº’ä»…éœ€ä½¿ç”¨ HTTP åè®®å’Œ JSON æ•°æ®æ ¼å¼å³å¯ã€‚</li>
</ol>

<h2 id="flask-æœåŠ¡å’Œ-ajax-è°ƒç”¨">Flask æœåŠ¡å’Œ AJAX è°ƒç”¨</h2>

<h3 id="flask-æœåŠ¡å°è£…">Flask æœåŠ¡å°è£…</h3>

<p>ä¸ºäº†å°†æ¨¡å‹ä»£ç å’Œ Flask æœåŠ¡è¿›è¡Œæ•´åˆï¼Œé¦–å…ˆå‡è®¾ä½ å·²ç»å¯¹æ¨¡å‹éƒ¨åˆ†ä»£ç åšäº†å®Œç¾çš„å°è£… ğŸ˜ï¼Œæ•´ä¸ªå·¥ç¨‹å…ˆå«åš <code>model-serving-demo</code> å§ã€‚æ•´ç†ä¸€ä¸‹ä»£ç çš„ç›®å½•ç»“æ„ï¼Œç»™ä¸€ä¸ªæˆ‘ä¸­æ„çš„ Python ç›®å½•ç»“æ„é£æ ¼ï¼š</p>

<pre><code>model-serving-demo/                # å·¥ç¨‹æ ¹ç›®å½•
â”œâ”€â”€ bin/                           # å¯æ‰§è¡Œå‘½ä»¤ç›®å½•
|   â”œâ”€ start.sh                    # å¯åŠ¨è„šæœ¬
|   â”œâ”€ stop.sh                     # åœæ­¢è„šæœ¬
|   â””â”€ ...
â”œâ”€â”€ conf/                          # é…ç½®æ–‡ä»¶ç›®å½•
|   â”œâ”€ logging.conf                # æ—¥å¿—é…ç½®æ–‡ä»¶
|   â”œâ”€ xxx_model.conf              # XXX Model é…ç½®æ–‡ä»¶
|   â””â”€ ...
â”œâ”€â”€ data/                          # æ•°æ®æ–‡ä»¶ç›®å½•
â”œâ”€â”€ docs/                          # æ–‡æ¡£ç›®å½•
â”œâ”€â”€ model_serving/                 # æ¨¡å—æ ¹ç›®å½•
|   â”œâ”€ models/                     # æ¨¡å‹ä»£ç ç›®å½•
|   |   â”œâ”€ __init__.py
|   |   â”œâ”€ xxx_model.py            # XXX Model ä»£ç 
|   |   â””â”€ ...
|   â”œâ”€ resources/                  # Flask RESTful Resources ä»£ç ç›®å½•
|   |   â”œâ”€ __init__.py
|   |   â”œâ”€ xxx_model_resource.py   # XXX Model Flask RESTful Resources ä»£ç 
|   |   â””â”€ ...
|   â”œâ”€ tests/                      # æµ‹è¯•ä»£ç æ ¹ç›®å½•
|   |   â”œâ”€ models                  # æ¨¡å‹æµ‹è¯•ä»£ç ç›®å½•
|   |   |   â”œâ”€ __init__.py
|   |   |   â”œâ”€ test_xxx_model.py   # XXX Model æµ‹è¯•ä»£ç 
|   |   |   â””â”€ ...
|   |   â”œâ”€ __init__.py
|   |   â””â”€ ...
|   â”œâ”€ tmp/                        # ä¸´æ—¶ç›®å½•
|   â””â”€ ...
â”œâ”€â”€ .gitignore                     # Git Ignore æ–‡ä»¶
â”œâ”€â”€ app.yaml                       # Google App Engine é…ç½®æ–‡ä»¶
â”œâ”€â”€ LICENSE                        # æˆæƒåè®®
â”œâ”€â”€ main.py                        # ä¸»ç¨‹åºä»£ç 
â”œâ”€â”€ README.md                      # è¯´æ˜æ–‡ä»¶
â””â”€â”€ requirements.txt               # ä¾èµ–åŒ…åˆ—è¡¨
</code></pre>

<p>æˆ‘ä»¬åˆ©ç”¨ä¸€ä¸ªæç®€çš„ç¤ºä¾‹ä»‹ç»æ•´ä¸ªæ¨¡å‹éƒ¨ç½²ï¼Œç›¸å…³çš„åº“ä¾èµ– <code>requirements.txt</code> å¦‚ä¸‹ï¼š</p>

<pre><code>Flask==1.0.2
Flask-RESTful==0.3.6
Flask-Cors==3.0.6
jsonschema==2.6.0
docopt==0.6.2

# æœ¬åœ°éƒ¨ç½²æ—¶éœ€ä¿ç•™ï¼ŒGAE éƒ¨ç½²æ—¶è¯·åˆ é™¤
# gunicorn==19.9.0
</code></pre>

<p>å…¶ä¸­ï¼š</p>

<ol>
<li><a href="http://flask.pocoo.org/" rel="noreferrer" target="_blank">Flask</a> ç”¨äºæ„å»º Flask æœåŠ¡ã€‚</li>
<li><a href="https://flask-restful.readthedocs.io/" rel="noreferrer" target="_blank">Flask-RESTful</a> ç”¨äºæ„å»º Flask RESTful APIã€‚</li>
<li><a href="https://flask-cors.readthedocs.io/" rel="noreferrer" target="_blank">Flask-Cors</a> ç”¨äºè§£å†³ AJAX è°ƒç”¨æ—¶çš„ <a href="https://zh.wikipedia.org/zh/è·¨ä¾†æºè³‡æºå…±äº«" rel="noreferrer" target="_blank">è·¨åŸŸé—®é¢˜</a>ã€‚</li>
<li><a href="https://python-jsonschema.readthedocs.io/" rel="noreferrer" target="_blank">jsonschema</a> ç”¨äºå¯¹è¯·æ±‚æ•°æ®çš„ JSON æ ¼å¼è¿›è¡Œæ ¡éªŒã€‚</li>
<li><a href="http://docopt.org/" rel="noreferrer" target="_blank">docopt</a> ç”¨äºä»ä»£ç æ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆå‘½ä»¤è¡Œå‚æ•°è§£æå™¨ã€‚</li>
<li><a href="https://gunicorn.org/" rel="noreferrer" target="_blank">gunicorn</a> ç”¨äºæä¾›çš„é«˜æ€§èƒ½ Python WSGI HTTP UNIX Serverã€‚</li>
</ol>

<p>XXX Model çš„ä»£ç  <code>xxx_model.py</code> å¦‚ä¸‹ï¼š</p>

<pre><code class="language-python">from ..utils.log_utils import XXXModel_LOGGER


LOGGER = XXXModel_LOGGER


class XXXModel():
    def __init__(self):
        LOGGER.info('Initializing XXX Model ...')

        LOGGER.info('XXX Model Initialized.')

    def hello(self, name:str) -&gt; str:
        return 'Hello, {name}!'.format(name=name)
</code></pre>

<p>å…¶ä¸­ <code>hello()</code> ä¸ºæœåŠ¡ä½¿ç”¨çš„æ–¹æ³•ï¼Œå…¶æ¥å—ä¸€ä¸ªç±»å‹ä¸º <code>str</code> çš„å‚æ•° <code>name</code>ï¼Œå¹¶è¿”å›ä¸€ä¸ªç±»å‹ä¸º <code>str</code> çš„ç»“æœã€‚</p>

<p>XXX Model çš„ Flask RESTful Resource ä»£ç  <code>xxx_model_resource.py</code> å¦‚ä¸‹ï¼š</p>

<pre><code class="language-python">from flask_restful import Resource, request

from ..models.xxx_model import XXXModel
from ..utils.validation_utils import validate_json


xxx_model_instance = XXXModel()
xxx_model_schema = {
    'type': 'object',
    'properties': {
        'name': {'type': 'string'}
    },
    'required': ['name']
}


class XXXModelResource(Resource):
    @validate_json(xxx_model_schema)
    def post(self):
        json = request.json

        return {'result': xxx_model_instance.hello(json['name'])}
</code></pre>

<p>æˆ‘ä»¬éœ€è¦ä» Flask RESTful çš„ <code>Resource</code> ç±»ç»§æ‰¿ä¸€ä¸ªæ–°çš„ç±» <code>XXXModelResource</code> ç”¨äºå¤„ç† XXX Model çš„æœåŠ¡è¯·æ±‚ã€‚å¦‚ä¸Šæ–‡ä»‹ç»ï¼Œæˆ‘ä»¬åœ¨æ•´ä¸ªæ¨¡å‹æœåŠ¡è°ƒç”¨ä¸­ä½¿ç”¨ POST è¯·æ±‚æ–¹å¼å’Œ JSON æ•°æ®æ ¼å¼ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åœ¨ç±» <code>XXXModelResource</code> ä¸­å®ç° <code>post()</code> æ–¹æ³•ï¼ŒåŒæ—¶å¯¹äºä¼ å…¥æ•°æ®çš„ JSON æ ¼å¼è¿›è¡Œæ ¡éªŒã€‚</p>

<p><code>post()</code> æ–¹æ³•ç”¨äºå¤„ç†æ•´ä¸ªæ¨¡å‹çš„æœåŠ¡è¯·æ±‚ï¼Œ<code>xxx_model_instance</code> æ¨¡å‹å®ä¾‹åœ¨ç±» <code>XXXModelResource</code> å¤–éƒ¨è¿›è¡Œå®ä¾‹åŒ–ï¼Œé¿å…æ¯æ¬¡å¤„ç†è¯·æ±‚æ—¶éƒ½è¿›è¡Œåˆå§‹åŒ–ã€‚<code>post()</code> çš„è¿”å›ç»“æœæ— éœ€å¤„ç†æˆ JSON æ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œä»…éœ€è¿”å›è¯å…¸æ•°æ®å³å¯ï¼ŒFlask RESTful ä¼šè‡ªåŠ¨å¯¹å…¶è¿›è¡Œè½¬æ¢ã€‚</p>

<p>ä¸ºäº†æ–¹ä¾¿å¯¹è¯·æ±‚æ•°æ®çš„ JSON æ ¼å¼è¿›è¡Œæ ¡éªŒï¼Œæˆ‘ä»¬å°†å¯¹ JSON æ ¼å¼çš„æ ¡éªŒå°è£…æˆä¸€ä¸ªä¿®é¥°å™¨ã€‚ä½¿ç”¨æ—¶å¦‚ä¸Šæ–‡ä»£ç ä¸­æ‰€ç¤ºï¼Œåœ¨ <code>post()</code> æ–¹æ³•ä¸Šæ–¹æ·»åŠ  <code>@validate_json(xxx_model_schema)</code> å³å¯ï¼Œå…¶ä¸­ <code>xxx_model_schema</code> ä¸ºä¸€ä¸ªç¬¦åˆ <a href="https://python-jsonschema.readthedocs.io/" rel="noreferrer" target="_blank">jsonschema</a> è¦æ±‚çš„ JSON Schemaã€‚ç¤ºä¾‹ä»£ç ä¸­è¦æ±‚ä¼ å…¥çš„ JSON æ•°æ® <strong>å¿…é¡»</strong> åŒ…å«ä¸€ä¸ªåä¸º <code>name</code> ç±»å‹ä¸º <code>string</code> çš„å­—æ®µã€‚</p>

<p><code>validate_json</code> ä¿®é¥°å™¨çš„ä»£ç  <code>validation_utils.py</code> å¦‚ä¸‹ï¼š</p>

<pre><code class="language-python">from functools import wraps
from jsonschema import validate, ValidationError
from flask_restful import request


def validate_json(schema, force=False):
    def decorator(f):
        @wraps(f)
        def wrapper(*args, **kwargs):
            json_body = request.get_json(force=force)

            if json_body is None:
                return {'message': 'No JSON object'}, 400

            try:
                validate(json_body, schema)
            except ValidationError as e:
                return {'message': e.message}, 400

            return f(*args, **kwargs)
        return wrapper
    return decorator
</code></pre>

<p>é¦–å…ˆæˆ‘ä»¬éœ€è¦éªŒè¯è¯·æ±‚åŒ…å«ä¸€ä¸ª JSON è¯·æ±‚ä½“ï¼ŒåŒæ—¶ JSON è¯·æ±‚ä½“çš„å†…å®¹éœ€æ»¡è¶³ <code>schema</code> çš„è¦æ±‚ã€‚å¦‚æœä¸æ»¡è¶³è¿™äº›æ¡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦è¿”å›å¯¹åº”çš„é”™è¯¯ä¿¡æ¯ <code>message</code>ï¼ŒåŒæ—¶è¿”å›åˆç†çš„ <a href="https://zh.wikipedia.org/zh/HTTPçŠ¶æ€ç " rel="noreferrer" target="_blank">HTTP çŠ¶æ€ç </a> (ä¾‹å¦‚ï¼š<code>400</code>) ç”¨äºè¡¨ç¤ºæ— æ³•å¤„ç†é”™è¯¯çš„è¯·æ±‚ã€‚å¯¹äºæ­£å¸¸çš„è¯·æ±‚å“åº” (å³ HTTP çŠ¶æ€ç ä¸º 200 çš„æƒ…å†µ)ï¼ŒçŠ¶æ€ç å¯ä»¥çœç•¥ä¸å†™ã€‚</p>

<p>æ„å»ºå®Œ XXX Model çš„ Flask RESTful Resource åï¼Œæˆ‘ä»¬å°±å¯ä»¥æ„å»º Flask çš„ä¸»æœåŠ¡äº†ï¼Œä¸»ç¨‹åºä»£ç  <code>main.py</code> å¦‚ä¸‹ï¼š</p>

<pre><code class="language-python">&quot;&quot;&quot;
Model Serving Demo

Usage:
    main.py [--host &lt;host&gt;] [--port &lt;port&gt;] [--debug]
    main.py (-h | --help)
    main.py --version

Options:
    --host &lt;host&gt;                     ç»‘å®šçš„ Host [default: 0.0.0.0]
    --port &lt;port&gt;                     ç»‘å®šçš„ Port [default: 9999]
    --debug                           æ˜¯å¦å¼€å¯ Debug [default: False]
    -h --help                         æ˜¾ç¤ºå¸®åŠ©
    -v --version                      æ˜¾ç¤ºç‰ˆæœ¬

&quot;&quot;&quot;

from docopt import docopt

from flask import Flask
from flask_cors import CORS
from flask_restful import Api

from model_serving.resources.xxx_model_resource import XXXModelResource


app = Flask(__name__)
CORS(app)

api = Api(app)
api.add_resource(XXXModelResource, '/v1/XXXModel')


if __name__ == '__main__':
    args = docopt(__doc__, version='Model Serving Demo v1.0.0')
    app.run(host=args['--host'], port=args['--port'], debug=args['--debug'])
</code></pre>

<p><code>docopt</code> åº“ç”¨äºä»ä»£ç æ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆå‘½ä»¤è¡Œå‚æ•°è§£æå™¨ï¼Œå…·ä½“ä½¿ç”¨æ–¹æ³•è¯·å‚è§ <a href="http://docopt.org/" rel="noreferrer" target="_blank">å®˜æ–¹æ–‡æ¡£</a>ã€‚æ•´ä¸ª Flask ä¸»æœåŠ¡çš„æ„å»ºæ¯”è¾ƒç®€å•ï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p>

<ol>
<li>æ„å»º Flask ä¸»ç¨‹åºï¼Œ<code>app = Flask(__name__)</code>ã€‚</li>
<li>è§£å†³ AJAX è°ƒç”¨çš„è·¨åŸŸé—®é¢˜ï¼Œ <code>CORS(app)</code>ã€‚ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæˆ‘ä»¬ä¸åŠ ä»»ä½•å‚æ•°ï¼Œå…è®¸ä»»æ„æ¥æºçš„è¯·æ±‚ï¼Œè¯¦ç»†çš„ä½¿ç”¨æ–¹å¼è¯·å‚è§ <a href="https://flask-cors.readthedocs.io/" rel="noreferrer" target="_blank">å®˜æ–¹æ–‡æ¡£</a>ã€‚</li>
<li>æ„å»º Flask RESTful APIï¼Œ<code>api = Api(app)</code>ã€‚</li>
<li>å°†æ„å»ºå¥½çš„ XXX Model çš„ Flask RESTful Resource æ·»åŠ åˆ° API ä¸­ï¼Œ<code>api.add_resource(XXXModelResource, '/v1/XXXModel')</code>ã€‚
å…¶ä¸­ç¬¬äºŒä¸ªå‚æ•°ä¸ºè¯·æ±‚çš„ URLï¼Œå¯¹äºè¿™ä¸ª URL çš„å»ºè®®å°†åœ¨åç»­å°èŠ‚ä¸­è¯¦ç»†è¯´æ˜ã€‚</li>
</ol>

<p>Flask ä¸»ç¨‹åºé…ç½®å®Œæ¯•åï¼Œæˆ‘ä»¬é€šè¿‡ <code>app.run()</code> åœ¨æœ¬åœ°å¯åŠ¨ Flask æœåŠ¡ï¼ŒåŒæ—¶å¯ä»¥æŒ‡å®šç»‘å®šçš„ä¸»æœºåï¼Œç«¯å£ï¼Œä»¥åŠæ˜¯å¦å¼€å¯è°ƒè¯•æ¨¡å¼ç­‰ã€‚é€šè¿‡ <code>python main.py</code> å¯åŠ¨ Flask æœåŠ¡åï¼Œå¯ä»¥åœ¨å‘½ä»¤è¡Œçœ‹åˆ°å¦‚ä¸‹ç±»ä¼¼çš„æ—¥å¿—ï¼š</p>

<pre><code>[2018/10/21 00:00:00] - [INFO] - [XXXModel] - Initializing XXX Model ...
[2018/10/21 00:00:00] - [INFO] - [XXXModel] - XXX Model Initialized.
 * Serving Flask app &quot;main&quot; (lazy loading)
 * Environment: production
   WARNING: Do not use the development server in a production environment.
   Use a production WSGI server instead.
 * Debug mode: off
[2018/10/21 00:00:00] - [INFO] - [werkzeug] -  * Running on http://0.0.0.0:9999/ (Press CTRL+C to quit)
</code></pre>

<p>ç°åœ¨å°±å¯ä»¥æµ‹è¯•è°ƒç”¨æœåŠ¡äº†ï¼Œæˆ‘ä»¬ç”¨ <code>curl</code> å‘½ä»¤è¿›è¡Œç®€å•çš„æµ‹è¯•ï¼Œç›¸å…³ä»£ç  <code>request-demo.sh</code> å¦‚ä¸‹ï¼š</p>

<pre><code class="language-bash">host=0.0.0.0
port=9999
url=/v1/XXXModel
curl_url=http://${host}:${port}${url}

invalid_json='{}'
valid_json='{&quot;name&quot;: &quot;Leo&quot;}'

# No JSON object
curl --request POST --url ${curl_url} --verbose

# Invalid JSON object
curl --header 'Content-Type: application/json; charset=UTF-8' \
    --request POST --data ${invalid_json} --url ${curl_url} --verbose

# Valid JSON object
curl --header 'Content-Type: application/json; charset=UTF-8' \
    --request POST --data ${valid_json} --url ${curl_url} --verbose
</code></pre>

<p>ä¸‰ç§ä¸åŒçš„è¯·æ±‚è¿”å›çš„ HTTP çŠ¶æ€ç å’Œç»“æœå¦‚ä¸‹ï¼š</p>

<pre><code>HTTP/1.0 400 BAD REQUEST
{&quot;message&quot;: &quot;No JSON object&quot;}

HTTP/1.0 400 BAD REQUEST
{&quot;message&quot;: &quot;'name' is a required property&quot;}

HTTP/1.0 200 OK
{&quot;result&quot;: &quot;Hello, Leo!&quot;}
</code></pre>

<p>ä¸Šæ–‡ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ <code>python main.py</code> åˆ©ç”¨å†…ç½®çš„ Server å¯åŠ¨äº† Flask æœåŠ¡ï¼Œå¯åŠ¨åæ—¥å¿—ä¸­æ‰“å°å‡ºæ¥ä¸€æ¡è­¦å‘Šä¿¡æ¯ï¼Œå‘Šè¯‰ä½¿ç”¨è€…ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨å†…ç½®çš„ Serverã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æˆ‘ä»¬å¯ä»¥åˆ©ç”¨é«˜æ€§èƒ½ Python WSGI HTTP UNIX Server <a href="https://gunicorn.org/" rel="noreferrer" target="_blank">gunicorn</a> æ¥å¯åŠ¨ Flask æœåŠ¡ã€‚</p>

<p>æœåŠ¡å¯åŠ¨ (<code>start.sh</code>) è„šæœ¬ä»£ç å¦‚ä¸‹ï¼š</p>

<pre><code class="language-bash">cd `dirname $0`
cd ..

base_dir=`pwd`
tmp_dir=${base_dir}/tmp
pid_file_path=${tmp_dir}/model-serving-demo.pid
log_file_path=${tmp_dir}/model-serving-demo.log

bind_host=0.0.0.0
bind_port=9999
workers=2

nohup gunicorn -b ${bind_host}:${bind_port} \
  -w ${workers} -p ${pid_file_path} \
  main:app &gt; ${log_file_path} 2&gt;&amp;1 &amp;
</code></pre>

<p>æœåŠ¡åœæ­¢ (<code>stop.sh</code>) è„šæœ¬ä»£ç å¦‚ä¸‹ï¼š</p>

<pre><code class="language-bash">cd `dirname $0`
cd ..

base_dir=`pwd`
tmp_dir=${base_dir}/tmp
pid_file_path=${tmp_dir}/model-serving-demo.pid

kill -TERM `echo ${pid_file_path}`
</code></pre>

<p>gunicorn çš„è¯¦ç»†å‚æ•°é…ç½®å’Œä½¿ç”¨æ•™ç¨‹è¯·å‚è§ <a href="https://docs.gunicorn.org/en/stable/" rel="noreferrer" target="_blank">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>

<h3 id="restful-api-è®¾è®¡">RESTful API è®¾è®¡</h3>

<p>RESTful API æ˜¯ä¸€ç§ç¬¦åˆ REST(Representational State Transferï¼Œè¡¨ç°å±‚çŠ¶æ€è½¬æ¢) åŸåˆ™çš„æ¡†æ¶ï¼Œè¯¥æ¡†æ¶æ˜¯ç”± Fielding åœ¨å…¶åšå£«è®ºæ–‡ <sup class="footnote-ref" id="fnref:fielding2000architectural"><a href="#fn:fielding2000architectural">1</a></sup> ä¸­æå‡ºã€‚ç›¸å…³çš„æ ¸å¿ƒæ¦‚å¿µå¦‚ä¸‹ï¼š</p>

<ol>
<li><strong>èµ„æº (Resources)</strong>ï¼Œå³ç½‘ç»œä¸­çš„ä¸€ä¸ªå®ä½“ (æ–‡æœ¬ï¼Œå›¾ç‰‡ï¼ŒæœåŠ¡ç­‰)ï¼Œä½¿ç”¨ä¸€ä¸ª URL è¿›è¡Œè¡¨ç¤ºã€‚</li>
<li><strong>è¡¨ç°å±‚ (Representation)</strong>ï¼Œèµ„æºå…·ä½“çš„å‘ˆç°å½¢å¼å³ä¸ºè¡¨ç°å±‚ï¼Œä¾‹å¦‚å›¾ç‰‡å¯ä»¥è¡¨ç¤ºä¸º PNG æ–‡ä»¶ï¼ŒéŸ³ä¹å¯ä»¥è¡¨ç¤ºä¸º MP3 æ–‡ä»¶ï¼Œè¿˜æœ‰æœ¬æ–‡ä½¿ç”¨çš„æ•°æ®æ ¼å¼ JSON ç­‰ã€‚HTTP è¯·æ±‚çš„å¤´ä¿¡æ¯ä¸­ç”¨ Accept å’Œ Content-Type å­—æ®µå¯¹è¡¨ç°å±‚è¿›è¡Œæè¿°ã€‚</li>
<li><strong>çŠ¶æ€è½¬æ¢ (State Transfer)</strong>ï¼Œäº’è”ç½‘é€šä¿¡åè®® HTTP åè®®æ˜¯ä¸€ä¸ªæ— çŠ¶æ€åè®®ï¼Œæ‰€æœ‰çš„çŠ¶æ€éƒ½ä¿å­˜åœ¨æœåŠ¡ç«¯ã€‚å› æ­¤å¦‚æœå®¢æˆ·ç«¯æƒ³è¦æ“ä½œæœåŠ¡å™¨ï¼Œå¿…é¡»é€šè¿‡æŸç§æ‰‹æ®µè®©æœåŠ¡å™¨ç«¯å‘ç”Ÿ <strong>çŠ¶æ€è½¬æ¢</strong>ã€‚å®¢æˆ·ç«¯åˆ©ç”¨ HTTP åè®®ä¸­çš„åŠ¨ä½œå¯¹æœåŠ¡å™¨è¿›è¡Œæ“ä½œï¼Œä¾‹å¦‚ï¼šGETï¼ŒPOSTï¼ŒPUTï¼ŒDELETE ç­‰ã€‚</li>
</ol>

<p>åˆ©ç”¨ RESTful API æ„å»ºæ¨¡å‹æœåŠ¡æ—¶ï¼Œéœ€è¦æ³¨æ„å¦‚ä¸‹å‡ ç‚¹ï¼š</p>

<ol>
<li>ä¸ºæ¨¡å‹æœåŠ¡è®¾ç½®ä¸“ç”¨åŸŸåï¼Œä¾‹å¦‚ï¼š<code>https://api.example.com</code>ï¼Œå¹¶é…ä»¥è´Ÿè½½å‡è¡¡ã€‚</li>
<li>å°† API çš„ç‰ˆæœ¬å·å†™å…¥ URL ä¸­ï¼Œä¾‹å¦‚ï¼š<code>https://api.example.com/v1</code>ã€‚</li>
<li>RESTful æ¡†æ¶ä¸­æ¯ä¸ª URL è¡¨ç¤ºä¸€ç§èµ„æºï¼Œå› æ­¤å¯ä»¥å°†æ¨¡å‹çš„åç§°ä½œä¸º URL çš„ç»ˆç‚¹ (Endpoint)ï¼Œä¾‹å¦‚ï¼š<code>https://api.example.com/v1/XXXModel</code>ã€‚</li>
<li>å¯¹äºæ“ä½œèµ„æºçš„ HTTP æ–¹å¼æœ‰å¤šç§ï¼Œç»¼åˆè€ƒè™‘å»ºè®®é€‰ç”¨ POST æ–¹å¼ï¼ŒåŒæ—¶å»ºè®®ä½¿ç”¨ JSON æ•°æ®æ ¼å¼ã€‚</li>
<li>ä¸ºè¯·æ±‚å“åº”è®¾ç½®åˆç†çš„çŠ¶æ€ç ï¼Œä¾‹å¦‚ï¼š200 OK è¡¨ç¤ºæ­£å¸¸è¿”å›ï¼Œ400 INVALID REQUEST è¡¨ç¤ºæ— æ³•å¤„ç†å®¢æˆ·ç«¯çš„é”™è¯¯è¯·æ±‚ç­‰ã€‚</li>
<li>å¯¹äºé”™è¯¯ç ä¸º 4xx çš„æƒ…å†µï¼Œå»ºè®®åœ¨è¿”å›ä¸­æ·»åŠ é”®åä¸º <code>message</code> çš„é”™è¯¯ä¿¡æ¯ã€‚</li>
</ol>

<h3 id="ajax-è°ƒç”¨">AJAX è°ƒç”¨</h3>

<p>å¯¹äºåŠ¨æ€ç½‘é¡µï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“çš„åœ¨åç«¯æœåŠ¡ä¸­å‘èµ· POST è¯·æ±‚è°ƒç”¨æ¨¡å‹æœåŠ¡ï¼Œç„¶åå°†ç»“æœåœ¨å‰ç«¯è¿›è¡Œæ¸²æŸ“ã€‚å¯¹äºé™æ€ç½‘é¡µï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ AJAX è¿›è¡Œç›¸å…³æ“ä½œã€‚é¦–å…ˆæˆ‘ä»¬éœ€è¦ä¸€ä¸ªäº¤äº’ç•Œé¢ï¼Œå¦‚ä¸‹ä¸ºåˆ©ç”¨ <a href="https://material.io/design/" rel="noreferrer" target="_blank">Google Material Design</a> é£æ ¼çš„ <a href="https://github.com/material-components/material-components-web" rel="noreferrer" target="_blank">Material Design Components Web</a> ç»„ä»¶è®¾è®¡ä¸€ä¸ªäº¤äº’ç•Œé¢ï¼Œå®ç°ç»†èŠ‚è¯·å‚è§ <a href="https://github.com/leovan/model-serving-demo/tree/master/client/xxx-model-ajax-client.html" rel="noreferrer" target="_blank">ç¤ºä¾‹ä»£ç </a>ã€‚</p>

<p>
  
<link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/material-components-web@latest/dist/material-components-web.min.css">





















<style type="text/css">
.center {
  justify-content: center;
}

.text-field--fullwidth {
  width: 100%;
}

.loading {
  width: 32px;
  height: 32px;
  position: relative;
  margin: auto;
}

.loading-bounce-1, .loading-bounce-2 {
  width: 100%;
  height: 100%;
  border-radius: 50%;
  background-color: #333;
  opacity: 0.6;
  position: absolute;
  top: 0;
  left: 0;

  -webkit-animation: bounce 2.0s infinite ease-in-out;
  animation: bounce 2.0s infinite ease-in-out;
}

.loading-bounce-2 {
  -webkit-animation-delay: -1.0s;
  animation-delay: -1.0s;
}

@-webkit-keyframes bounce {
  0%, 100% { -webkit-transform: scale(0.0) }
  50% { -webkit-transform: scale(1.0) }
}

@keyframes bounce {
  0%, 100% {
    transform: scale(0.0);
    -webkit-transform: scale(0.0);
  } 50% {
    transform: scale(1.0);
    -webkit-transform: scale(1.0);
  }
}
</style>

<div class="mdc-card">
  <div class="mdc-card__actions center">
    <div class="mdc-typography--headline6"><span>XXX Model AJAX Client</span></div>
  </div>
  <div class="mdc-card__actions">
    <div class="mdc-text-field text-field--fullwidth" data-mdc-auto-init="MDCTextField">
      <input id="name" class="mdc-text-field__input" value="Leo">
      <div class="mdc-line-ripple"></div>
    </div>
  </div>
  <div class="mdc-card__actions center">
    <button id="submit" class="mdc-button mdc-button--outlined" data-mdc-auto-init="MDCRipple">Submit</button>
    <div class="loading" id="loading" style="display: none;">
      <div class="loading-bounce-1"></div>
      <div class="loading-bounce-2"></div>
    </div>
  </div>
  <div class="mdc-card__actions center">
    <div class="mdc-typography--body1">
      <p id="result">Result</p>
    </div>
  </div>
</div>

<script>
  $(document).ready(function() {
    $("#submit").click(function() {
      $("#submit").toggle();
      $("#loading").toggle();

      /*
      $.ajax({
        url: "http://0.0.0.0:9999/v1/XXXModel",
        method: "POST",
        contentType: "application/json; charset=UTF-8",
        data: JSON.stringify({"name": $("#name").val()}),
        timeout: 3000,

        success: function (data, textStatus, jqXHR) {
          $("#result").html(data.result);

          $("#loading").toggle();
          $("#submit").toggle();
        },
        error: function (jqXHR, textStatus, errorThrown) {
          $("#result").html(errorThrown);

          $("#loading").toggle();
          $("#submit").toggle();
        }
      });
      */

      setTimeout(function() {
        $("#result").html("Hello, " + $("#name").val() + "!");
        $("#submit").toggle();
        $("#loading").toggle();
      }, 1000);
    });
  });
</script>





</p>

<p>AJAX æœåŠ¡è¯·æ±‚ä»£ç çš„æ ¸å¿ƒéƒ¨åˆ†å¦‚ä¸‹ï¼š</p>

<pre><code class="language-javascript">$(document).ready(function() {
    $(&quot;#submit&quot;).click(function() {
        $.ajax({
            url: &quot;http://0.0.0.0:9999/v1/XXXModel&quot;,
            method: &quot;POST&quot;,
            contentType: &quot;application/json; charset=UTF-8&quot;,
            data: JSON.stringify({&quot;name&quot;: $(&quot;#name&quot;).val()}),
            timeout: 3000,

            success: function (data, textStatus, jqXHR) {
                $(&quot;#result&quot;).html(data.result);
            },
            error: function (jqXHR, textStatus, errorThrown) {
                $(&quot;#result&quot;).html(errorThrown);
            }
        });
    });
});
</code></pre>

<p>ä»£ç ä½¿ç”¨äº† <a href="https://jquery.com/" rel="noreferrer" target="_blank">jQuery</a> çš„ç›¸å…³å‡½æ•°ã€‚<code>JSON.stringify({&quot;name&quot;: $(&quot;#name&quot;).val()})</code> è·å– ID ä¸º <code>name</code> çš„å…ƒç´ çš„å€¼ï¼Œå¹¶å°†å…¶è½¬æ¢æˆç¬¦åˆæœåŠ¡ç«¯è¦æ±‚çš„ JSON æ ¼å¼ã€‚é€šè¿‡ AJAX å‘è¿œç¨‹å‘å‡ºè¯·æ±‚åï¼Œå¦‚æœè¯·æ±‚æˆåŠŸåˆ™å°†è¿”å›æ•°æ® <code>data</code> ä¸­å¯¹åº”çš„ç»“æœ <code>result</code> å¡«å……åˆ° ID ä¸º <code>result</code> çš„å…ƒç´ ä¸­ï¼Œå¦åˆ™å¡«å…¥è¿”å›çš„é”™è¯¯ä¿¡æ¯ã€‚</p>

<h2 id="google-app-engine-éƒ¨ç½²">Google App Engine éƒ¨ç½²</h2>

<p>ä¸Šæ–‡ä¸­å·²ç»ä»‹ç»äº†å¦‚ä½•åœ¨æœ¬åœ°åˆ©ç”¨ Flask éƒ¨ç½²æ¨¡å‹æœåŠ¡å’Œç›¸å…³è°ƒç”¨æ–¹æ³•ï¼Œä½†å¦‚æœå¸Œæœ›åœ¨è‡ªå·±çš„ç½‘ç«™ä¸­è°ƒç”¨æ—¶ï¼Œåˆ™åˆ©ç”¨ SaaS æ¥éƒ¨ç½²ç¬¦åˆä¼šæ˜¯ä¸€ä¸ªä¸äºŒä¹‹é€‰ã€‚å›½å†…å¤–å¤šä¸ªå‚å•†å‡æä¾›äº†ç›¸åº”çš„ SaaS äº§å“ï¼Œä¾‹å¦‚ <a href="https://cloud.google.com/appengine/" rel="noreferrer" target="_blank">Google</a>ï¼Œ<a href="https://aws.amazon.com/partners/saas-on-aws/" rel="noreferrer" target="_blank">Amazon</a>ï¼Œ<a href="https://azure.microsoft.com/en-us/solutions/saas/" rel="noreferrer" target="_blank">Microsoft</a> ç­‰ã€‚Google App Engine (GAE) æä¾›äº†ä¸€ä¸ª <a href="https://cloud.google.com/free/docs/always-free-usage-limits" rel="noreferrer" target="_blank">å§‹ç»ˆå…è´¹</a> æ–¹æ¡ˆï¼Œè™½ç„¶éƒ¨ç½²é˜¶æ®µä¼šå—åˆ° GFW çš„å½±å“ï¼Œä½†è°ƒç”¨é˜¶æ®µæµ‹è¯•å½±å“å¹¶ä¸æ˜¯å¾ˆå¤§ (ä¸åŒåœ°åŒºå’ŒæœåŠ¡æä¾›å•†ä¼šæœ‰å·®å¼‚)ã€‚ç»¼åˆè€ƒè™‘ï¼Œæœ¬æ–‡é€‰æ‹© GAE ä½œä¸º SaaS å¹³å°éƒ¨ç½²æœåŠ¡ï¼Œå„ä½çœ‹å®˜è¯·è‡ªå¤‡æ¢¯å­ã€‚</p>

<h3 id="ç¯å¢ƒå‡†å¤‡">ç¯å¢ƒå‡†å¤‡</h3>

<p>é¦–å…ˆï¼Œåœ¨ <a href="https://console.cloud.google.com/projectcreate" rel="noreferrer" target="_blank">Google Cloud Platform Console</a> ä¸­å»ºç«‹ä¸€ä¸ªæ–°çš„ Projectï¼Œå‡è®¾é¡¹ç›®åä¸º <code>YOUR_PROJECT_ID</code>ã€‚</p>

<p>å…¶æ¬¡ï¼Œæ ¹æ® <a href="https://cloud.google.com/sdk/docs/" rel="noreferrer" target="_blank">Google Cloud SDK æ–‡æ¡£</a> åœ¨æœ¬åœ°å®‰è£…ç›¸åº”ç‰ˆæœ¬çš„ Google Cloud SDKã€‚MacOS ä¸‹å»ºè®®é€šè¿‡ <code>brew cask install google-cloud-sdk</code> æ–¹å¼å®‰è£…ï¼Œå®‰è£…å®Œæ¯•åç¡®è®¤åœ¨å‘½ä»¤è¡Œä¸­å¯ä»¥è¿è¡Œ <code>gcloud</code> å‘½ä»¤ã€‚</p>

<pre><code class="language-bash">$ gcloud version
Google Cloud SDK 221.0.0
bq 2.0.35
core 2018.10.12
gsutil 4.34
</code></pre>

<h3 id="æ„å»º-gae-å·¥ç¨‹">æ„å»º GAE å·¥ç¨‹</h3>

<p>æ¨¡å‹æœåŠ¡ä»…ä½œä¸ºåç«¯åº”ç”¨ï¼Œå› æ­¤æœ¬èŠ‚ä¸ä»‹ç»å‰ç«¯é¡µé¢å¼€å‘çš„ç›¸å…³éƒ¨åˆ†ï¼Œæœ‰å…´è¶£çš„åŒå­¦è¯·å‚è§ <a href="https://cloud.google.com/appengine/docs/standard/python3/quickstart" rel="noreferrer" target="_blank">å®˜æ–¹æ–‡æ¡£</a>ã€‚GAE éƒ¨ç½² Python Web åº”ç”¨é‡‡ç”¨äº† <a href="https://wsgi.readthedocs.io/en/latest/" rel="noreferrer" target="_blank">WSGI æ ‡å‡†</a>ï¼Œæˆ‘ä»¬æ„å»ºçš„æœ¬åœ°éƒ¨ç½²ç‰ˆæœ¬å®Œå…¨æ»¡è¶³è¿™ä¸ªè¦æ±‚ï¼Œå› æ­¤ä»…éœ€ä¸ºé¡¹ç›®åœ¨æ ¹ç›®å½•æ·»åŠ ä¸€ä¸ª GAE é…ç½®æ–‡ä»¶ <code>app.yaml</code> å³å¯ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>

<pre><code class="language-yaml">runtime: python37

handlers:
  - url: /.*
    script: main.app

skip_files:
  - .idea/
  - .vscode/
  - __pycache__/
  - .hypothesis/
  - .pytest_cache/
  - bin/
  - ^(.*/)?.*\.py[cod]$
  - ^(.*/)?.*\$py\.class$
  - ^(.*/)?.*\.log$
</code></pre>

<p>å…¶ä¸­ï¼Œ<code>runtime</code> æŒ‡å®šäº†æœåŠ¡è¿è¡Œçš„ç¯å¢ƒï¼Œ<code>handlers</code> æŒ‡å®šäº†ä¸åŒçš„ URL å¯¹åº”çš„å¤„ç†ç¨‹åºï¼Œåœ¨æ­¤æ‰€æœ‰çš„ URL å‡ç”± <code>main.py</code> ä¸­çš„ <code>app</code> è¿›è¡Œå¤„ç†ï¼Œ<code>skip_files</code> ç”¨äºè¿‡æ»¤ä¸éœ€è¦ä¸Šä¼ çš„æ–‡ä»¶ã€‚æ›´å¤šå…³äº <code>app.yaml</code> çš„è®¾ç½®ä¿¡æ¯ï¼Œè¯·å‚è§ <a href="https://cloud.google.com/appengine/docs/standard/python3/config/appref" rel="noreferrer" target="_blank">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>

<h3 id="éƒ¨ç½²-gae-å·¥ç¨‹">éƒ¨ç½² GAE å·¥ç¨‹</h3>

<p>åœ¨éƒ¨ç½² GAE å·¥ç¨‹ä¹‹å‰æˆ‘ä»¬å¯ä»¥åˆ©ç”¨æœ¬åœ°çš„å¼€å‘ç¯å¢ƒå¯¹å…¶è¿›è¡Œæµ‹è¯•ï¼Œæµ‹è¯•æ— è¯¯åï¼Œå³å¯è¿è¡Œå¦‚ä¸‹å‘½ä»¤å°†å…¶éƒ¨ç½²åˆ° GAE ä¸Šï¼š</p>

<pre><code class="language-bash">gcloud app deploy --project [YOUR_PROJECT_ID]
</code></pre>

<p>ç„¶åæ ¹æ®å‘½ä»¤è¡Œæç¤ºå®Œæˆæ•´ä¸ªéƒ¨ç½²æµç¨‹ï¼Œéƒ¨ç½²å®Œæˆçš„è¿œç¨‹æœåŠ¡ URL ä¸º <code>https://YOUR_PROJECT_ID.appspot.com</code>ï¼Œæ›´å¤šçš„æµ‹è¯•å’Œéƒ¨ç½²ç»†èŠ‚è¯·å‚è§ <a href="https://cloud.google.com/appengine/docs/standard/python3/testing-and-deploying-your-app" rel="noreferrer" target="_blank">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>

<p>éƒ¨ç½²åçš„ GAE æœåŠ¡ä½¿ç”¨äº†å…¶è‡ªå¸¦çš„åŸŸå <code>appspot.com</code>ã€‚å¦‚æœä½ æ‹¥æœ‰è‡ªå·±çš„åŸŸåï¼Œå¯ä»¥æ ¹æ®å®˜æ–¹æ–‡æ¡£ <a href="https://cloud.google.com/appengine/docs/standard/python3/mapping-custom-domains" rel="noreferrer" target="_blank">è®¾ç½®è‡ªå·±çš„åŸŸå</a> å¹¶ <a href="https://cloud.google.com/appengine/docs/standard/python3/secURLng-custom-domains-with-ssl" rel="noreferrer" target="_blank">å¼€å¯ SSL</a>ã€‚</p>

<div class="blockquote" style='border-left: 4px solid #369BE5;'>æœ¬æ–‡éƒ¨åˆ†å†…å®¹å‚è€ƒäº† Genthial çš„åšå®¢ <a href="https://guillaumegenthial.github.io/serving.html" rel="noreferrer" target="_blank">Serving a model with Flask</a> å’Œé˜®ä¸€å³°çš„åšå®¢ <a href="https://www.ruanyifeng.com/blog/2011/09/restful.html" rel="noreferrer" target="_blank">ç†è§£RESTfulæ¶æ„</a> å’Œ <a href="https://www.ruanyifeng.com/blog/2014/05/restful_api.html" rel="noreferrer" target="_blank">RESTful API è®¾è®¡æŒ‡å—</a>ã€‚</div>
<div class="footnotes">

<hr />

<ol>
<li id="fn:fielding2000architectural">Fielding, Roy T., and Richard N. Taylor. <em>Architectural styles and the design of network-based software architectures.</em> Vol. 7. Doctoral dissertation: University of California, Irvine, 2000.
 <a class="footnote-return" href="#fnref:fielding2000architectural">â†©</a></li>
</ol>
</div>



<link rel="stylesheet" href="/css/donate.css" />


<div class="donate">
  <div class="donate-header"></div>
  <div class="donate-slug" id="donate-slug">serving-models-with-flask-and-gae</div>
  <button class="donate-button">èµ èµ</button>
  <div class="donate-footer">ã€ŒçœŸè¯šèµèµï¼Œæ‰‹ç•™ä½™é¦™ã€</div>
</div>
<div class="donate-modal-wrapper">
  <div class="donate-modal">
    <div class="donate-box">
      <div class="donate-box-content">
        <div class="donate-box-content-inner">
          <div class="donate-box-header">ã€ŒçœŸè¯šèµèµï¼Œæ‰‹ç•™ä½™é¦™ã€</div>
          <div class="donate-box-body">
            <div class="donate-box-money">
              <button class="donate-box-money-button donate-box-money-button-unchecked" id="donate-box-money-button-2" data-v="2" data-unchecked="ï¿¥ 2" data-checked="2 å…ƒ">ï¿¥ 2</button>
              <button class="donate-box-money-button donate-box-money-button-unchecked" id="donate-box-money-button-5" data-v="5" data-unchecked="ï¿¥ 5" data-checked="5 å…ƒ">ï¿¥ 5</button>
              <button class="donate-box-money-button donate-box-money-button-unchecked" id="donate-box-money-button-10" data-v="10" data-unchecked="ï¿¥ 10" data-checked="10 å…ƒ">ï¿¥ 10</button>
              <button class="donate-box-money-button donate-box-money-button-unchecked" id="donate-box-money-button-50" data-v="50" data-unchecked="ï¿¥ 50" data-checked="50 å…ƒ">ï¿¥ 50</button>
              <button class="donate-box-money-button donate-box-money-button-unchecked" id="donate-box-money-button-100" data-v="100" data-unchecked="ï¿¥ 100" data-checked="100 å…ƒ">ï¿¥ 100</button>
              <button class="donate-box-money-button donate-box-money-button-unchecked" id="donate-box-money-button-custom" data-v="custom" data-unchecked="ä»»æ„é‡‘é¢" data-checked="ä»»æ„é‡‘é¢">ä»»æ„é‡‘é¢</button>
            </div>
            <div class="donate-box-pay">
              <img class="donate-box-pay-qrcode" id="donate-box-pay-qrcode" src=""/>
            </div>
          </div>
          <div class="donate-box-footer">
            <div class="donate-box-pay-method donate-box-pay-method-checked" data-v="wechat-pay">
              <img class="donate-box-pay-method-image" id="donate-box-pay-method-image-wechat-pay" src=""/>
            </div>
            <div class="donate-box-pay-method" data-v="alipay">
              <img class="donate-box-pay-method-image"  id="donate-box-pay-method-image-alipay" src=""/>
            </div>
          </div>
        </div>
      </div>
    </div>
    <button type="button" class="donate-box-close-button">
      <svg class="donate-box-close-button-icon" fill="#fff" viewBox="0 0 24 24" width="24" height="24"><path d="M13.486 12l5.208-5.207a1.048 1.048 0 0 0-.006-1.483 1.046 1.046 0 0 0-1.482-.005L12 10.514 6.793 5.305a1.048 1.048 0 0 0-1.483.005 1.046 1.046 0 0 0-.005 1.483L10.514 12l-5.208 5.207a1.048 1.048 0 0 0 .006 1.483 1.046 1.046 0 0 0 1.482.005L12 13.486l5.207 5.208a1.048 1.048 0 0 0 1.483-.006 1.046 1.046 0 0 0 .005-1.482L13.486 12z" fill-rule="evenodd"></path></svg>
    </button>
  </div>
</div>

<script type="text/javascript" src="/js/donate.js"></script>
</script>


  <footer>
  
<nav class="post-nav">
  <span class="nav-prev">&larr; <a href="/user_blogdown/cn/2018/10/seq2seq-and-attention-machanism/">åºåˆ—åˆ°åºåˆ— (Seq2Seq) å’Œæ³¨æ„åŠ›æœºåˆ¶ (Attention Machanism)</a></span>
  <span class="nav-next"><a href="/user_blogdown/cn/2018/11/computational-complexity-and-dynamic-programming/">è®¡ç®—å¤æ‚æ€§ (Computational Complexity) ä¸åŠ¨æ€è§„åˆ’ (Dynamic Programming)</a> &rarr;</span>
</nav>
<script type="text/javascript">
document.addEventListener('keyup', function(e) {
  if (e.target.nodeName.toUpperCase() != 'BODY') return;
  var url = false;
  if (e.which == 37) {  
    
    url = '\/user_blogdown\/cn\/2018\/10\/seq2seq-and-attention-machanism\/';
    
  } else if (e.which == 39) {  
    
    url = '\/user_blogdown\/cn\/2018\/11\/computational-complexity-and-dynamic-programming\/';
    
  }
  if (url) window.location = url;
});
</script>




<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-2608165017777396"
     data-ad-slot="1261604535"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>





<section class="comments">
  <div id="disqus_thread"></div>
  <script>
  var disqus_config = function () {
  
    this.page.url = "https:\/\/zeqiang.fun" + location.pathname;
  
  };
  (function() {
    var inIFrame = function() {
      var iframe = true;
      try { iframe = window.self !== window.top; } catch (e) {}
      return iframe;
    };
    if (inIFrame()) return;
    var disqus_js = '//Zeqiang.disqus.com/embed.js';
    var d = document, s = d.createElement('script');
    s.src = disqus_js; s.async = true;
    s.setAttribute('data-timestamp', +new Date());
    var t = d.getElementById('disqus_thread');
    var b = false, l = function(scroll) {
      if (b) return;
      (d.head || d.body).appendChild(s); b = true;
      if (scroll) t.scrollIntoView();
    }
    s.onerror = function(e) {
      if (sessionStorage.getItem('failure-note')) return;
      t.innerText = 'Sorry, but you cannot make comments because Disqus failed to load for some reason. It is known to be blocked in China. If you are sure it is not blocked in your region, please refresh the page. ä¸­å›½å¤§é™†åœ°åŒºè¯»è€…éœ€è¦ç¿»å¢™æ‰èƒ½å‘è¡¨è¯„è®ºã€‚';
      sessionStorage.setItem('failure-note', true);
    };
    
    if (location.hash.match(/^#comment-[0-9]+$/)) return l(true);
    var c = function() {
      if (b) return;
      var rect = t.getBoundingClientRect();
      if (rect.top < window.innerHeight && rect.bottom >= 0) l();
    };
    window.addEventListener('load', c);
    d.addEventListener('scroll', c);
  })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>





<script src="//cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/prism.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/plugins/autoloader/prism-autoloader.min.js"></script>

<script src="//cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/plugins/show-language/prism-show-language.min.js"></script>

<script>
    (function() {
        if (!self.Prism) {
            return;
        }

        Prism.languages.dos = Prism.languages.powershell;
        Prism.languages.gremlin = Prism.languages.groovy;

        var Languages = {
            'r': 'R', 'python': 'Python', 'xml': 'XML', 'html': 'HTML',
            'yaml': 'YAML', 'latex': 'LaTeX', 'tex': 'TeX',
            'powershell': 'PowerShell', 'javascript': 'JavaScript',
            'dos': 'DOS', 'qml': 'QML', 'json': 'JSON', 'bash': 'Bash',
            'text': 'Text', 'txt': 'Text', 'sparql': 'SPARQL',
            'gremlin': 'Gremlin', 'cypher': 'Cypher', 'ngql': 'nGQL',
            'shell': 'Shell', 'sql': 'SQL', 'apacheconf': 'Apache Configuration'
        };

        Prism.hooks.add('before-highlight', function(env) {
        	var language = Languages[env.language] || env.language;
        	env.element.setAttribute('data-language', language);
        });
    })();
</script>




<script async src="/js/fix-toc.js"></script>
<script async src="/js/center-img.js"></script>
<script async src="/js/right-quote.js"></script>
<script async src="/js/fix-footnote.js"></script>
<script async src="/js/external-link.js"></script>
<script async src="/js/alt-title.js"></script>
<script src="/js/no-highlight.js"></script>
<script src="/js/math-code.js"></script>


<script>
window.MathJax = {
  loader: {
    load: ['[tex]/boldsymbol']
  },
  tex: {
    tags: "all",
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$']],
    processEscapes: true,
    processEnvironments: true,
    packages: {
      '[+]': ['boldsymbol']
    }
  }
};
</script>
<script type="text/javascript" id="MathJax-script" async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-chtml.js" crossorigin></script>







<script async src="/js/load-typekit.js"></script>

<script src="//cdnjs.cloudflare.com/ajax/libs/lazysizes/5.3.2/lazysizes.min.js"></script>

<script src="//cdn.jsdelivr.net/npm/vanilla-back-to-top@latest/dist/vanilla-back-to-top.min.js"></script>
<script>
addBackToTop({
  diameter: 48
})
</script>



  <hr>
  <div class="copyright no-border-bottom">
    <div class="copyright-author-year">
      <span>&copy; 2017-2021 Leo Van</span>
    </div>
    <div class="copyright-links">
      <a href="https://github.com/leovan" rel="noreferrer" target="_blank">Github</a>
      <span> Â· </span>
      <a href="https://orcid.org/0000-0002-9556-7821" rel="noreferrer" target="_blank">ORCID</a>
      <span> Â· </span>
      <span>I am Mr. Black.</span>
    </div>
  </div>
  </footer>
  </article>
  </body>
</html>

